<!DOCTYPE html>
<html>
<head>
	
	<title>MAP FULL SIZE</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>

    <!-- Adding TableTop --> 
	<script src='https://cdnjs.cloudflare.com/ajax/libs/tabletop.js/1.5.1/tabletop.min.js'></script>

	<!-- //Adding FullScreen -->     
 	<script src='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/Leaflet.fullscreen.min.js'></script>
	<link href='https://api.mapbox.com/mapbox.js/plugins/leaflet-fullscreen/v1.0.1/leaflet.fullscreen.css' rel='stylesheet'/>

<style>

.info { 
	padding: 6px 8px; 
	font: 14px/16px Roboto, Helvetica, sans-serif; 
	background: white; 
	background: rgba(255,255,255,0.8); 
	box-shadow: 0 0 15px rgba(0,0,0,0.2); 
	border-radius: 5px; 
} 


.info h4 { 
	margin: 0 0 5px; 
	color: #262c33; 
}

.legend {
    line-height: 18px;
    color: #555;
}

.legend i {
    width: 18px;
    height: 18px;
    float: left;
    margin-right: 8px;
    opacity: 0.7;
}

</style>

	
</head>

<body>

	<div id="mapid" style="width: 100%; height: 600px;"></div>

<script>
	var mbAttr = 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
			'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
		mbUrl = 'https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw';

	var grayscale   = L.tileLayer(mbUrl, {id: 'mapbox/light-v9', tileSize: 512, zoomOffset: -1, attribution: mbAttr})

	var vaccine = L.layerGroup();
	var diagnostic = L.layerGroup();
	var therapeutic = L.layerGroup();


	var mymap = L.map('mapid', {
		center: [40.717491, -100.674050],
		zoom: 4,
		layers: [grayscale]
	});

	mymap.addLayer(vaccine)
	mymap.addLayer(diagnostic)
	mymap.addLayer(therapeutic)

	var info = L.control();

	info.onAdd = function (map) {
	    this._div = L.DomUtil.create('div', 'info');
	    this.update();
	    return this._div;
	};

	info.update = function (props) {
	    this._div.innerHTML = '<h4>Public Funding for COVID-19</h4>';
	};

	info.addTo(mymap);

	var legend = L.control({position: 'bottomright'});

	legend.onAdd = function (map) {

	    var div = L.DomUtil.create('div', 'info legend'),
	        labels = ['Vaccines', 'Diagnostics', 'Therapeutics'],
	        icon = ['vaccine.png', 'diagnostic.png', 'therapeutic.png'];

	    // loop through our density intervals and generate a label with a colored square for each interval
	    for (var i = 0; i < labels.length; i++) {
	        div.innerHTML +=
	            '<img src="' + icon[i] + '" width="20" height="20" style="padding-right:12px;""> ' + labels[i] + '<br>';
	    }

	    return div;
	};

	legend.addTo(mymap);


	mymap.addControl(new L.Control.Fullscreen());


	Tabletop.init({
		key: 'https://docs.google.com/spreadsheets/d/11SrwemuqE5HsbipdmBNNukQsM4qBHjQSawNl6K94GHY/edit?usp=sharing',
		callback: addPoints,
		parseNumbers: true,
		simpleSheet: true
	});

	var overlays = {
		"Vaccines": vaccine,
		"Diagnostics": diagnostic,
		"Therapeutics": therapeutic
	};

	L.control.layers({}, overlays, {collapsed: false}).addTo(mymap);

	var vaccineIcon = L.icon({
		iconUrl: 'vaccine.png',
		iconSize: [25,25]
	});

	var diagnosticIcon = L.icon({
		iconUrl: 'diagnostic.png',
		iconSize: [30,30]
	});

	var therapeuticIcon = L.icon({
		iconUrl: 'therapeutic.png',
		iconSize: [25,25]
	});


	function addPoints(data, tabletop) {

		tabletop.sheets('US Universities').elements.forEach(function (row) {

			switch (row["Type of Research (Vaccine, Diagnostic, Therapeutic)"]) {

				case "Vaccine":
					L.marker([row.Latitude, row.Longitude], {icon: vaccineIcon}).bindPopup(
						`<h3>` + row.University + `</h3>` + '<p style="text-align:left;">' + 'Type: ' + '<span style="color:grey;font-weight:bold;">' + row["Type of Research (Vaccine, Diagnostic, Therapeutic)"] + '</span>' + '<br>' + 'Stage: ' + '<span style="color:grey;font-weight:bold;">' + row["Stage (Preclinical, Clinical)"] + '</span>' + '<br>' + 'NIH Funding (2003-2019) (USD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of NIH funding (2003-2019) (USD)"] + '</span>' + '<br>' + 'NIH Funding (2019-2020) (USD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of NIH funding (2019-2020) (USD)"] + '</span>' + '<br>' + 'Public Funding (Other) (USD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of other public funding eg DOD etc"] + '</span>' + '<br>' + 'URLs: ' + '<a href="' + row["Link_2"] + '">' + 'Link_1' + ', ' + '<a href="' + row["Link_3"] + '">' + 'Link_2' + '<br>' + '</p>', {maxWidth: 1000}).addTo(vaccine);
					break;
				case "Diagnostic":
					L.marker([row.Latitude, row.Longitude], {icon: diagnosticIcon}).bindPopup(
						`<h3>` + row.University + `</h3>` + '<p style="text-align:left;">' + 'Type: ' + '<span style="color:grey;font-weight:bold;">' + row["Type of Research (Vaccine, Diagnostic, Therapeutic)"] + '</span>' + '<br>' + 'Stage: ' + '<span style="color:grey;font-weight:bold;">' + row["Stage (Preclinical, Clinical)"] + '</span>' + '<br>' + 'NIH Funding (2003-2019) (USD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of NIH funding (2003-2019) (USD)"] + '</span>' + '<br>' + 'NIH Funding (2019-2020) (USD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of NIH funding (2019-2020) (USD)"] + '</span>' + '<br>' + 'Public Funding (Other) (USD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of other public funding eg DOD etc"] + '</span>' + '<br>' + 'URLs: ' + '<a href="' + row["Link_2"] + '">' + 'Link_1' + ', ' + '<a href="' + row["Link_3"] + '">' + 'Link_2' + '<br>' + '</p>', {maxWidth: 1000}).addTo(diagnostic);
					break;
				case "Therapeutic":
					L.marker([row.Latitude, row.Longitude], {icon: therapeuticIcon}).bindPopup(
						`<h3>` + row.University + `</h3>` + '<p style="text-align:left;">' + 'Type: ' + '<span style="color:grey;font-weight:bold;">' + row["Type of Research (Vaccine, Diagnostic, Therapeutic)"] + '</span>' + '<br>' + 'Stage: ' + '<span style="color:grey;font-weight:bold;">' + row["Stage (Preclinical, Clinical)"] + '</span>' + '<br>' + 'NIH Funding (2003-2019) (USD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of NIH funding (2003-2019) (USD)"] + '</span>' + '<br>' + 'NIH Funding (2019-2020) (USD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of NIH funding (2019-2020) (USD)"] + '</span>' + '<br>' + 'Public Funding (Other) (USD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of other public funding eg DOD etc"] + '</span>' + '<br>' + 'URLs: ' + '<a href="' + row["Link_2"] + '">' + 'Link_1' + ', ' + '<a href="' + row["Link_3"] + '">' + 'Link_2' + '<br>' + '</p>', {maxWidth: 1000}).addTo(therapeutic);
					break;
			}
					

		});


		tabletop.sheets('Canadian Universities').elements.forEach(function (row) {


			switch (row["Type of Research (Vaccine, Diagnostic, Therapeutic)"]) {

				case "Vaccine":
					L.marker([row.Latitude, row.Longitude], {icon: vaccineIcon}).bindPopup(
						`<h3>` + row.University + `</h3>` + '<p style="text-align:left;">' + 'Type: ' + '<span style="color:grey;font-weight:bold;">' + row["Type of Research (Vaccine, Diagnostic, Therapeutic)"] + '</span>' + '<br>' + 'Stage: ' + '<span style="color:grey;font-weight:bold;">' + row["Stage (Preclinical, Clinical)"] + '</span>' + '<br>' + 'CIHR Funding (CAD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of CIHR funding (CAD)"] + '</span>' + '<br>' + 'Genome Canada Funding (CAD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of Genome Canada funding (CAD)"] + '</span>' + '<br>' + 'Public Funding (Other) (CAD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of other public funding (NSERC, SSHRC, CRCC, IDRC, CATCO, etc.) (CAD)"] + '</span>' + '<br>' + 'URLs: ' + '<a href="' + row["Link_1"] + '">' + 'Link_1' + '</a>' + ', ' + '<a href="' + row["Link_2"] + '">' + 'Link_2' + '</a>' + '<br>' + 'Principal Investigators: ' + '<span style="color:grey;font-weight:bold;">' + row["Principle_Investigators"] + '</span>' + '<br>' + '</p>', {maxWidth: 1000}).addTo(vaccine);
					break;
				case "Diagnostic":
					L.marker([row.Latitude, row.Longitude], {icon: diagnosticIcon}).bindPopup(
						`<h3>` + row.University + `</h3>` + '<p style="text-align:left;">' + 'Type: ' + '<span style="color:grey;font-weight:bold;">' + row["Type of Research (Vaccine, Diagnostic, Therapeutic)"] + '</span>' + '<br>' + 'Stage: ' + '<span style="color:grey;font-weight:bold;">' + row["Stage (Preclinical, Clinical)"] + '</span>' + '<br>' + 'CIHR Funding (CAD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of CIHR funding (CAD)"] + '</span>' + '<br>' + 'Genome Canada Funding (CAD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of Genome Canada funding (CAD)"] + '</span>' + '<br>' + 'Public Funding (Other) (CAD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of other public funding (NSERC, SSHRC, CRCC, IDRC, CATCO, etc.) (CAD)"] + '</span>' + '<br>' + 'URLs: ' + '<a href="' + row["Link_1"] + '">' + 'Link_1' + '</a>' + ', ' + '<a href="' + row["Link_2"] + '">' + 'Link_2' + '</a>' + '<br>' + 'Principal Investigators: ' + '<span style="color:grey;font-weight:bold;">' + row["Principle_Investigators"] + '</span>' + '<br>' + '</p>', {maxWidth: 1000}).addTo(diagnostic);
					break;
				case "Therapeutic":
					L.marker([row.Latitude, row.Longitude], {icon: therapeuticIcon}).bindPopup(
						`<h3>` + row.University + `</h3>` + '<p style="text-align:left;">' + 'Type: ' + '<span style="color:grey;font-weight:bold;">' + row["Type of Research (Vaccine, Diagnostic, Therapeutic)"] + '</span>' + '<br>' + 'Stage: ' + '<span style="color:grey;font-weight:bold;">' + row["Stage (Preclinical, Clinical)"] + '</span>' + '<br>' + 'CIHR Funding (CAD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of CIHR funding (CAD)"] + '</span>' + '<br>' + 'Genome Canada Funding (CAD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of Genome Canada funding (CAD)"] + '</span>' + '<br>' + 'Public Funding (Other) (CAD): ' + '<span style="color:grey;font-weight:bold;">' + row["Amount of other public funding (NSERC, SSHRC, CRCC, IDRC, CATCO, etc.) (CAD)"] + '</span>' + '<br>' + 'URLs: ' + '<a href="' + row["Link_1"] + '">' + 'Link_1' + '</a>' + ', ' + '<a href="' + row["Link_2"] + '">' + 'Link_2' + '</a>' + '<br>' + 'Principal Investigators: ' + '<span style="color:grey;font-weight:bold;">' + row["Principle_Investigators"] + '</span>' + '<br>' + '</p>', {maxWidth: 1000}).addTo(therapeutic);
					break;
			}

		});

		tabletop.sheets('Aus & NZ Universities').elements.forEach(function (row) {
			L.circle([row.Latitude, row.Longitude]).addTo(mymap).bindPopup(`<h3>` + row.University + `</h3>`);

		});

	}

</script>

</body>
</html>
